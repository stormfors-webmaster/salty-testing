console.log("map.js salty-testing");var Webflow=Webflow||[];Webflow.push(async function(){const T="pk.eyJ1IjoiZmVsaXhoZWxsc3Ryb20iLCJhIjoiY20zaXhucjcwMDVwdTJqcG83ZjMxemJlciJ9._TipZd1k8nMEslWbCDg6Eg";let f=9,u=[-118.37655405160609,33.78915439099377],w=0;mapboxgl.accessToken=T;const t=new mapboxgl.Map({container:"map",style:"mapbox://styles/cv-mapbox/cm5zh2w0i002g01sfdcrs6dgj",projection:"globe",zoom:f,center:u,pitch:w});t.addControl(new mapboxgl.NavigationControl,"bottom-right"),t.addControl(new mapboxgl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0}),"bottom-right"),window.dev={openHome:d,closeHome:c,openBeachList:s,closeBeachList:h,openBeach:p,closeBeach:l,openShop:P};const r=new Map;C();async function C(){M(),k(),window.location.search.includes("beaches")&&(console.log("beaches query found"),c(),s(),window.history.pushState({},"",window.location.pathname)),window.innerWidth<=991&&$(".mapboxgl-ctrl-bottom-right").hide()}function k(){document.querySelectorAll("[temp-data=beach]").forEach(o=>{let a=o.getAttribute("temp-id"),n=parseFloat(o.getAttribute("lat")),i=parseFloat(o.getAttribute("lon"));if(isNaN(n)||isNaN(i)||n<-90||n>90||i<-180||i>180){console.warn(`Invalid coordinates for beach ${a}: lat=${n}, lon=${i}`);return}let g=[i,n],b=o.getAttribute("popup-text");x(g,b,a)})}function x(e,o,a){let n=new mapboxgl.Popup({offset:25}).setText(o),i=document.createElement("div");i.className="beach-marker",i.id=a;const g=new mapboxgl.Marker(i).setLngLat(e).setPopup(n).addTo(t);r.set(a,g),n.on("open",()=>{let b=n.getLngLat().lng,j=n.getLngLat().lat;console.log("popup opened"),console.log(a),t.flyTo({center:[b,j],zoom:14,pitch:75}),m(),s(),p(a),window.scrollTo({top:0,behavior:"instant"})}),n.on("close",()=>{console.log("popup closed"),console.log(a),window.scrollTo({top:0,behavior:"instant"})})}function M(){document.addEventListener("click",e=>{if(e.target.matches("[open-sidebar=home], [open-sidebar=home] *")&&(e.preventDefault(),m(),d(),z()),e.target.matches("[open-sidebar=beach-list], [open-sidebar=beach-list] *")&&(e.preventDefault(),m(),window.innerWidth>479&&s(),window.innerWidth<=991&&v(),window.innerWidth<=479&&s()),e.target.matches("[map-link=item], [map-link=item] *")){const o=e.target.matches("[map-link=item]")?e.target:e.target.closest("[map-link=item]");let a=o.getAttribute("lat"),n=o.getAttribute("lon"),i=o.getAttribute("temp-id");W(i),t.flyTo({center:[n,a],zoom:14,pitch:75}),p(i)}if(e.target.matches(".modal_close-button, .modal_close-button *, .mobile-back, .mobile-back *")&&l(),e.target.matches("[close-sidebar=beach]")&&(H(),s()),e.target.matches("[map-function=expand]")&&(v(),setTimeout(()=>{$("[sidebar-toggle=beach-list]").show(),$(".mapboxgl-ctrl-bottom-right").show()},1e3)),e.target.matches("[map-function=collapse] *, [map-function=collapse]")&&(y(),$("[sidebar=beach-list]").css({transform:"translateX(-100%)",transition:"none"}),$("[sidebar=home]").css({transform:"translateX(0%)",transition:"none"}),$("[sidebar-toggle=beach-list]").hide(),$(".mapboxgl-ctrl-bottom-right").hide()),e.target.matches("[toggle-sidebar=home]")&&L(),e.target.matches("[toggle-sidebar=beach-list]")&&S(),e.target.matches(".mob-beach-top-inner, .mob-beach-top-inner *")&&(console.log("mob-beach-top-inner clicked"),l(),s()),e.target.matches("[stormfors-sort=reverse]")){const o=document.querySelector(".beach-list_list"),a=[...o.children];a.reverse(),a.forEach(n=>o.appendChild(n))}})}function L(){$("[sidebar-toggle=home]").hasClass("folded")?d():c()}function S(){$("[sidebar-toggle=beach-list]").hasClass("folded")?s():(h(),l())}function v(){$("[map-function=expand]").hide(),$("[map-function=container]").addClass("expanded");for(let e=0;e<100;e++)setTimeout(()=>{t.resize()},e*10);t.resize(),setTimeout(()=>{t.resize(),$("[map-function=collapse]").show()},1e3)}function y(){$("[map-function=collapse]").hide(),$("[map-function=container]").removeClass("expanded");for(let e=0;e<100;e++)setTimeout(()=>{t.resize()},e*10);setTimeout(()=>{$("[map-function=expand]").show()},1e3)}function P(){window.scrollTo({top:0,behavior:"instant"}),$("[page=shop]").removeClass("hide")}function X(){window.scrollTo({top:0,behavior:"instant"}),$("[page=shop]").addClass("hide")}function d(){window.scrollTo({top:0,behavior:"instant"}),$("[sidebar=home]").removeClass("folded"),$("[sidebar-toggle=home]").removeClass("folded"),setTimeout(()=>{$("[map-function=expand]").show(),$("[home-toggle-icon=when-open]").show(),$("[home-toggle-icon=when-closed]").hide()},500)}function c(){window.scrollTo({top:0,behavior:"instant"}),$("[sidebar=home]").addClass("folded"),$("[sidebar-toggle=home]").addClass("folded"),$("[home-toggle-icon=when-open]").hide(),$("[home-toggle-icon=when-closed]").show()}function s(){window.scrollTo({top:0,behavior:"instant"}),window.innerWidth<=479&&$("[sidebar=beach-list]").css({transition:"none",transform:"translateX(0%)"}),$("[sidebar-toggle=beach-list]").removeClass("folded"),$("[sidebar=beach-list]").removeClass("folded"),$("[beach-toggle-icon=when-open]").show(),$("[beach-toggle-icon=when-closed]").hide()}function h(){window.scrollTo({top:0,behavior:"instant"}),$("[sidebar-toggle=beach-list]").addClass("folded"),$("[sidebar=beach-list]").addClass("folded"),$("[beach-toggle-icon=when-open]").hide(),$("[beach-toggle-icon=when-closed]").show()}function p(e){window.scrollTo({top:0,behavior:"instant"}),window.innerWidth<=479&&$("[sidebar=beach-list]").css({transition:"none",transform:"translateX(-100%)"}),$("[sidebar=beach]").show(),$("[sidebar="+e+"]").show(),$("[sidebar="+e+"]").parent().show()}function l(e){window.scrollTo({top:0,behavior:"instant"}),$("[sidebar=beach]").hide(),$("[sidebar="+e+"]").hide(),$("[sidebar="+e+"]").parent().hide()}function m(){window.history.pushState({},"",window.location.pathname),window.scrollTo({top:0,behavior:"instant"}),c(),h(),l(),$("[beach-item=container]").hide()}function z(){t.flyTo({center:u,zoom:f,pitch:w})}function A(){const e=t.getCenter();console.log(`Map center: ${e.lng}, ${e.lat}`)}function E(){const e=t.getZoom();console.log(`Map zoom level: ${e}`)}function B(){const e=t.getPitch();console.log(`Map pitch: ${e}`)}function Z(){t.on("moveend",()=>{A(),E(),B()}),t.on("click",e=>{console.log(`${e.lngLat.lng}, ${e.lngLat.lat}`),console.log(e)})}function W(e){const o=r.get(e);o&&o.togglePopup()}function H(){r.forEach(e=>{const o=e.getPopup();o.isOpen()&&o.remove()})}});
